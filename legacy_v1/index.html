<!DOCTYPE html>
<html lang="es-DO">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#003366">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>FinanzasRD AI - Tu Asistente Financiero</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Librerías para exportación PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <!-- Librería para exportación Excel -->
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>

    <!-- Styles -->
    <link rel="stylesheet" href="css/styles.css">
</head>

<body>
    <div class="app-container">
        <!-- Mobile Menu Toggle -->
        <button class="menu-toggle" onclick="toggleSidebar()">
            <i class="fas fa-bars"></i>
        </button>

        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="logo">
                <div class="logo-icon">
                    <i class="fas fa-chart-line"></i>
                </div>
                <div class="logo-text">Finanzas<span>RD</span> AI</div>
            </div>

            <nav class="nav-menu">
                <div class="nav-item active" data-page="dashboard">
                    <i class="fas fa-home"></i>
                    <span>Dashboard</span>
                </div>
                <div class="nav-item" data-page="coach">
                    <i class="fas fa-robot"></i>
                    <span>Coach IA</span>
                </div>
                <div class="nav-item" data-page="transactions">
                    <i class="fas fa-exchange-alt"></i>
                    <span>Transacciones</span>
                </div>
                <div class="nav-item" data-page="planning">
                    <i class="fas fa-compass"></i>
                    <span>Planificación</span>
                </div>
                <div class="nav-item" data-page="debts">
                    <i class="fas fa-link"></i>
                    <span>Deudas</span>
                </div>
                <div class="nav-item" data-page="reports">
                    <i class="fas fa-chart-bar"></i>
                    <span>Reportes</span>
                </div>
            </nav>

            <div class="user-profile">
                <div class="user-info">
                    <div class="user-avatar">JD</div>
                    <div class="user-details">
                        <h4>Juan Diaz</h4>
                        <p>Usuario Premium</p>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Header -->
            <header class="header">
                <div class="header-title">
                    <h1>Hola, Juan</h1>
                    <p>Aqui esta tu resumen financiero de hoy</p>
                </div>
                <div class="header-actions">
                    <div class="search-box">
                        <i class="fas fa-search"></i>
                        <input type="text" placeholder="Buscar transacciones...">
                    </div>
                    <button class="dark-mode-toggle" onclick="toggleDarkMode()" title="Cambiar tema">
                        <i class="fas fa-moon"></i>
                    </button>
                    <button class="notification-btn">
                        <i class="fas fa-bell"></i>
                        <span class="notification-badge"></span>
                    </button>
                </div>
            </header>

            <!-- 1. DASHBOARD VIEW (Vista Principal) -->
            <div id="view-dashboard" class="view-section active">
                <div class="dashboard-grid">
                    <!-- KPI Cards (Automated from JS) -->
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon blue"><i class="fas fa-wallet"></i></div>
                        </div>
                        <div class="stat-value" id="total-balance">RD$ 0</div>
                        <div class="stat-label">Balance Total</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon green"><i class="fas fa-arrow-down"></i></div>
                        </div>
                        <div class="stat-value" id="total-income">RD$ 0</div>
                        <div class="stat-label">Ingresos Mes</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon red"><i class="fas fa-shopping-cart"></i></div>
                        </div>
                        <div class="stat-value" id="total-expenses">RD$ 0</div>
                        <div class="stat-label">Gastos Mes</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon gold"><i class="fas fa-piggy-bank"></i></div>
                        </div>
                        <div class="stat-value" id="savings-rate">0%</div>
                        <div class="stat-label">Tasa Ahorro</div>
                    </div>
                </div>

                <!-- Main Trend Chart -->
                <div class="card" style="margin-top: 24px;">
                    <div class="card-header">
                        <h3 class="card-title">Tendencias (Últimos 6 Meses)</h3>
                    </div>
                    <div class="card-body" style="height: 300px;">
                        <canvas id="trendChart"></canvas>
                    </div>
                </div>

                <div class="content-grid" style="margin-top:24px;">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Gastos por Categoría</h3>
                        </div>
                        <div class="card-body"><canvas id="expensesChart"></canvas></div>
                    </div>
                    <!-- Coach Widget (Resumen) -->
                    <div class="card" id="coach-widget">
                        <div class="card-header">
                            <h3 class="card-title"><i class="fas fa-robot"></i> Coach IA</h3>
                            <span class="card-action" onclick="navigateTo('coach')">Abrir Chat</span>
                        </div>
                        <div class="card-body" id="ai-recommendations"></div>
                    </div>
                </div>
            </div>

            <!-- 2. COACH IA VIEW (Chat Interface) -->
            <div id="view-coach" class="view-section">
                <div class="coach-layout"
                    style="display: grid; grid-template-columns: 350px 1fr; gap: 20px; height: calc(100vh - 100px);">

                    <!-- LEFT SIDEBAR: Contexto -->
                    <aside class="coach-sidebar" style="overflow-y: auto; padding-right: 5px;">

                        <!-- Profile Card -->
                        <div class="card profile-fin-card"
                            style="background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%); color: white; margin-bottom: 20px;">
                            <div class="card-body">
                                <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                                    <div class="avatar"
                                        style="width: 50px; height: 50px; background: rgba(255,255,255,0.1); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5rem;">
                                        👤
                                    </div>
                                    <div>
                                        <h4 style="margin: 0; font-weight: 600;">Mi Perfil</h4>
                                        <span class="badge"
                                            style="background: var(--primary); font-size: 0.75rem;">Premium</span>
                                    </div>
                                </div>
                                <div class="mini-stats"
                                    style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                                    <div><small style="color: #94a3b8;">Ingresos</small>
                                        <div id="coach-income" style="font-weight: 600;">RD$0</div>
                                    </div>
                                    <div><small style="color: #94a3b8;">Gastos</small>
                                        <div id="coach-expenses" style="font-weight: 600;">RD$0</div>
                                    </div>
                                    <div
                                        style="grid-column: span 2; margin-top: 5px; padding-top: 5px; border-top: 1px solid rgba(255,255,255,0.1);">
                                        <small style="color: #94a3b8;">Balance del Mes</small>
                                        <div id="coach-balance" style="font-size: 1.1rem; color: var(--success);">RD$0
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Numero Verde Display -->
                        <div class="card green-number-card"
                            style="margin-bottom: 20px; border-left: 4px solid var(--success);">
                            <div class="card-body">
                                <h5 style="color: var(--text-secondary); margin-bottom: 10px;">Tu Número Verde 🌱</h5>
                                <div id="coach-green-number"
                                    style="font-size: 2rem; font-weight: 700; color: var(--success);">RD$0</div>
                                <p id="coach-green-desc"
                                    style="font-size: 0.85rem; color: var(--text-secondary); margin-top: 5px;">
                                    Este es tu dinero real disponible para gastar sin culpa hoy.
                                </p>
                            </div>
                        </div>

                        <!-- Sugerencias Contextuales -->
                        <h5 style="margin-bottom: 15px; color: var(--text-secondary);">Sugerencias Rápidas</h5>
                        <div id="coach-suggestions">
                            <!-- Injected via JS -->
                        </div>

                    </aside>

                    <!-- RIGHT AREA: Chat Interface -->
                    <main class="chat-container"
                        style="display: flex; flex-direction: column; background: white; border-radius: var(--radius); box-shadow: var(--shadow); overflow: hidden;">

                        <!-- Header Chat -->
                        <div class="chat-header"
                            style="padding: 15px 20px; border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center; background: #f8fafc;">
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <div style="width: 10px; height: 10px; background: var(--success); border-radius: 50%;">
                                </div>
                                <span style="font-weight: 600;">Coach FinanzasRD AI</span>
                            </div>
                            <span style="font-size: 0.8rem; color: var(--text-secondary);">En línea</span>
                        </div>

                        <!-- Messages Area -->
                        <div class="chat-messages" id="chat-messages"
                            style="flex: 1; padding: 20px; overflow-y: auto; background-image: radial-gradient(#e2e8f0 1px, transparent 1px); background-size: 20px 20px;">
                            <div class="message ai">
                                <div class="msg-bubble">
                                    👋 ¡Hola! Soy tu Coach Financiero. Veo que tienes algunos movimientos recientes. ¿En
                                    qué nos enfocamos hoy?
                                </div>
                                <div class="msg-meta">Justo ahora</div>
                            </div>
                        </div>

                        <!-- Quick Actions Panel -->
                        <div id="quick-actions-panel"
                            style="padding: 10px 20px; display: flex; gap: 10px; overflow-x: auto; white-space: nowrap;">
                            <!-- Injected via JS -->
                        </div>

                        <!-- Input Area -->
                        <div class="chat-input-area"
                            style="padding: 20px; border-top: 1px solid var(--border-color); background: white;">
                            <div style="position: relative;">
                                <input type="text" class="chat-input" id="chat-input"
                                    placeholder="Escribe tu consulta..."
                                    style="width: 100%; padding: 12px 50px 12px 15px; border-radius: 25px; border: 1px solid var(--border-color); outline: none; transition: all 0.3s;">
                                <button class="chat-send-btn" onclick="sendChatMessage()"
                                    style="position: absolute; right: 5px; top: 50%; transform: translateY(-50%); background: var(--primary); color: white; border: none; width: 35px; height: 35px; border-radius: 50%; cursor: pointer;">
                                    <i class="fas fa-paper-plane"></i>
                                </button>
                            </div>
                        </div>
                    </main>
                </div>
            </div>

            <!-- 3. TRANSACCIONES VIEW -->
            <div id="view-transactions" class="view-section">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Historial de Transacciones</h3>
                        <div class="header-actions">
                            <div class="search-box"><i class="fas fa-search"></i><input type="text"
                                    id="full-search-transactions" placeholder="Buscar..."></div>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="transaction-list" id="full-transaction-list"></div>
                    </div>
                </div>
            </div>

            <!-- 4. PLANIFICACIÓN VIEW (Metas + Presupuestos) -->
            <div id="view-planning" class="view-section">
                <h2 style="margin-bottom:20px;">Tu Mapa Financiero</h2>
                <div class="planning-grid">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">🛡️ Fondo de Emergencia</h3>
                            <span id="emergency-months" style="font-weight:bold; color:var(--secondary);">0 Meses</span>
                        </div>
                        <div class="card-body" id="emergency-widget"></div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">🎯 Metas de Ahorro</h3>
                            <span class="card-action" onclick="openGoalModal()"><i class="fas fa-plus"></i> Nueva</span>
                        </div>
                        <div class="card-body">
                            <div id="full-goals-list"></div>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">📊 Presupuestos Mensuales</h3>
                            <span class="card-action" onclick="openBudgetModal()"><i class="fas fa-plus"></i>
                                Nuevo</span>
                        </div>
                        <div class="card-body">
                            <div id="full-budget-list"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 5. DEUDAS VIEW -->
            <div id="view-debts" class="view-section">
                <h2 style="margin-bottom:20px;">Plan "Adiós Deudas"</h2>
                <div class="debt-strategy-box">
                    <h3>⛓️‍💥 Tu Estrategia Recomendada: <span id="debt-strategy-name">Analizando...</span></h3>
                    <p id="debt-strategy-desc">Agrega tus deudas para calcular tu fecha de libertad financiera.</p>
                </div>
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Tus Deudas Activas</h3>
                        <span class="card-action" onclick="openDebtModal()"><i class="fas fa-plus"></i> Agregar
                            Deuda</span> <!-- Placeholder func -->
                    </div>
                    <div class="card-body">
                        <div id="debts-list-container">
                            <div class="text-center" style="padding:20px; color:#999;">No hay deudas registradas.
                                ¡Excelente!</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 6. REPORTES VIEW -->
            <div id="view-reports" class="view-section">
                <div class="report-header">
                    <h1>📊 Central de Reportes</h1>
                    <p>Exporta tu data y visualiza tu progreso anual.</p>
                </div>
                <div class="export-panel">
                    <div class="export-card" onclick="exportToPDFInfographic()">
                        <i class="fas fa-file-pdf" style="font-size:3em; color:#ef4444; margin-bottom:10px;"></i>
                        <h3>Infografía Mensual</h3>
                        <p>Resumen visual para compartir.</p>
                    </div>
                    <div class="export-card" onclick="exportToExcel()">
                        <i class="fas fa-file-excel" style="font-size:3em; color:#22c55e; margin-bottom:10px;"></i>
                        <h3>Data Bruta (Excel)</h3>
                        <p>Todas tus transacciones.</p>
                    </div>
                </div>
            </div>


        </main>
    </div>

    <!-- Floating Action Button -->
    <button class="fab" onclick="openTransactionModal()">
        <i class="fas fa-plus"></i>
    </button>

    <!-- Transaction Modal -->
    <div class="modal-overlay" id="transaction-modal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Nueva Transaccion</h3>
                <button class="modal-close" onclick="closeModal('transaction-modal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="transaction-form">
                    <div class="form-group">
                        <label class="form-label">Tipo de Transaccion</label>
                        <select class="form-select" id="transaction-type" onchange="toggleTransactionFields()">
                            <option value="expense">Gasto</option>
                            <option value="income">Ingreso</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Descripcion</label>
                        <input type="text" class="form-input" id="transaction-description"
                            placeholder="Ej: Supermercado Bravo, Uber, etc." oninput="predictCategory()">
                        <div class="ai-tag" id="category-prediction" style="display: none;">
                            <i class="fas fa-robot"></i>
                            <span>IA sugiere: <strong id="suggested-category">Alimentacion</strong></span>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Monto (RD$)</label>
                            <input type="number" class="form-input" id="transaction-amount" placeholder="0.00"
                                step="0.01">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Fecha</label>
                            <input type="date" class="form-input" id="transaction-date">
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Cuenta</label>
                        <select class="form-select" id="transaction-account">
                            <option value="banreservas">Banreservas - Debito</option>
                            <option value="popular">Popular - Debito</option>
                            <option value="bhd">BHD Leon</option>
                            <option value="cash">Efectivo</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">
                            <input type="checkbox" id="is-recurring" onchange="toggleRecurrenceOptions()">
                            Transacción recurrente
                        </label>
                    </div>

                    <div class="form-group" id="recurrence-group" style="display: none;">
                        <label class="form-label">Frecuencia</label>
                        <select class="form-select" id="recurrence-pattern">
                            <option value="daily">Diaria</option>
                            <option value="weekly">Semanal</option>
                            <option value="biweekly">Quincenal</option>
                            <option value="monthly">Mensual</option>
                        </select>
                    </div>

                    <div class="form-group" id="category-group">
                        <label class="form-label">Categoria</label>
                        <select class="form-select" id="transaction-category">
                            <option value="alimentacion_supermercado">Alimentacion - Supermercado</option>
                            <option value="alimentacion_restaurantes">Alimentacion - Restaurantes</option>
                            <option value="alimentacion_comida_rapida">Alimentacion - Comida Rapida</option>
                            <option value="transporte_gasolina">Transporte - Gasolina</option>
                            <option value="transporte_publico">Transporte - Publico</option>
                            <option value="transporte_uber">Transporte - Uber/Metro</option>
                            <option value="vivienda_alquiler">Vivienda - Alquiler</option>
                            <option value="vivienda_servicios">Vivienda - Servicios</option>
                            <option value="servicios_telefono">Servicios - Telefono/Internet</option>
                            <option value="servicios_suscripciones">Servicios - Suscripciones</option>
                            <option value="salud_farmacia">Salud - Farmacia</option>
                            <option value="salud_medico">Salud - Medico</option>
                            <option value="entretenimiento_cine">Entretenimiento - Cine</option>
                            <option value="entretenimiento_streaming">Entretenimiento - Streaming</option>
                            <option value="shopping_ropa">Shopping - Ropa</option>
                            <option value="shopping_electronica">Shopping - Electronica</option>
                            <option value="educacion_cursos">Educacion - Cursos</option>
                            <option value="familia_remesas">Familia - Remesas</option>
                            <option value="otros_impuestos">Otros - Impuestos</option>
                            <option value="otros_otros">Otros - Varios</option>
                        </select>
                    </div>

                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-check"></i>
                        Guardar Transaccion
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Goal Modal -->
    <div class="modal-overlay" id="goal-modal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Nueva Meta de Ahorro</h3>
                <button class="modal-close" onclick="closeModal('goal-modal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="goal-form">
                    <div class="form-group">
                        <label class="form-label">Nombre de la Meta</label>
                        <input type="text" class="form-input" id="goal-name"
                            placeholder="Ej: Vacaciones, Auto nuevo, etc.">
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Monto Objetivo (RD$)</label>
                            <input type="number" class="form-input" id="goal-target" placeholder="0.00" step="0.01">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ahorrado (RD$)</label>
                            <input type="number" class="form-input" id="goal-current" placeholder="0.00" step="0.01">
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Fecha Objetivo</label>
                        <input type="date" class="form-input" id="goal-deadline">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Icono</label>
                        <select class="form-select" id="goal-icon">
                            <option value="plane">Viajes</option>
                            <option value="car">Auto</option>
                            <option value="home">Casa</option>
                            <option value="education">Educacion</option>
                            <option value="health">Salud</option>
                            <option value="gift">Regalos</option>
                            <option value="electronics">Electronica</option>
                            <option value="savings">Ahorro General</option>
                        </select>
                    </div>

                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-bullseye"></i>
                        Crear Meta
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Budget Modal -->
    <div class="modal-overlay" id="budget-modal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">GestiÃ³n de Presupuesto</h3>
                <button class="modal-close" onclick="closeModal('budget-modal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="budget-form">
                    <input type="hidden" id="budget-id">
                    <div class="form-group">
                        <label class="form-label">CategorÃ­a</label>
                        <select class="form-select" id="budget-category">
                            <option value="alimentacion">AlimentaciÃ³n</option>
                            <option value="transporte">Transporte</option>
                            <option value="vivienda">Vivienda</option>
                            <option value="servicios">Servicios</option>
                            <option value="entretenimiento">Entretenimiento</option>
                            <option value="salud">Salud</option>
                            <option value="shopping">Shopping</option>
                            <option value="familia">Familia</option>
                            <option value="educacion">EducaciÃ³n</option>
                            <option value="otros">Otros</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">LÃ­mite Mensual (RD$)</label>
                        <input type="number" class="form-input" id="budget-limit" placeholder="0.00" step="0.01"
                            required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Color Identificativo</label>
                        <div class="color-picker-container" style="display: flex; gap: 10px; margin-top: 5px;">
                            <input type="color" id="budget-color" value="#003366"
                                style="width: 50px; height: 40px; border: none; padding: 0; background: none;">
                            <span style="font-size: 12px; color: #666; align-self: center;">Selecciona un color</span>
                        </div>
                    </div>

                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i>
                        Guardar Presupuesto
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toast-container"></div>

    <!-- Scripts -->
    <script src="js/app.js"></script>
</body>

</html>